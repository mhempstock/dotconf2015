<form script="autodiscover.js" stylesheet="agenda.css">
  <label>Agenda</label>
  <row>
    <panel>
      <input type="radio" token="date" searchWhenChanged="true">
        <label>Day</label>
        <default>2015-09-22</default>
        <choice value="2015-09-22">Tuesday</choice>
        <choice value="2015-09-23">Wednesday</choice>
        <choice value="2015-09-24">Thursday</choice>
        <choice value="*">All Days</choice>
        <change>
          <condition value="2015-09-22">
            <set token="earliest">1442901600</set>
            <set token="latest">1442948400</set>
          </condition>
          <condition value="2015-09-23">
            <set token="earliest">1442988000</set>
            <set token="latest">1443034800</set>
          </condition>
          <condition value="2015-09-24">
            <set token="earliest">1443074400</set>
            <set token="latest">1443121200</set>
          </condition>
          <condition value="*">
            <set token="earliest">1442901600</set>
            <set token="latest">1443121200</set>
          </condition>
        </change>
      </input>
      <input type="multiselect" token="skillLevel" searchWhenChanged="true">
        <label>Skill Level</label>
        <search>
          <query>|inputlookup confSessions | dedup skillLevel</query>
        </search>
        <fieldForLabel>skillLevel</fieldForLabel>
        <fieldForValue>skillLevel</fieldForValue>
        <valuePrefix>skillLevel="</valuePrefix>
        <valueSuffix>"</valueSuffix>
        <delimiter> OR </delimiter>
        <choice value="*">ALL</choice>
        <default>*</default>
      </input>
      <input type="multiselect" token="track">
        <label>Track</label>
        <search>
          <query>|inputlookup confSessions | dedup track</query>
        </search>
        <fieldForLabel>track</fieldForLabel>
        <fieldForValue>track</fieldForValue>
        <valuePrefix>track="</valuePrefix>
        <valueSuffix>"</valueSuffix>
        <delimiter> OR </delimiter>
        <choice value="*">ALL</choice>
        <default>*</default>
      </input>
      <input type="multiselect" token="products" searchWhenChanged="true">
        <label>Product</label>
        <choice value="*">ALL</choice>
        <search>
          <query>|inputlookup confSessions | makemv products delim=";;" |mvexpand products | dedup products</query>
        </search>
        <fieldForLabel>products</fieldForLabel>
        <fieldForValue>products</fieldForValue>
        <default>*</default>
        <valuePrefix>products="*</valuePrefix>
        <valueSuffix>*"</valueSuffix>
        <delimiter> AND </delimiter>
      </input>
            <input type="text" token="sessionPlan">
        <label>Own Agenda Sessions</label>
        <default>NonePlanned</default>
      </input>
    </panel>
    <panel>
      <html>
          <h1>Instructions</h1>
          <ul>
          <li>Use the filters to view the agenda</li>
             <li>Clicking on a chart item will drilldown to a description at the bottom of the page.</li>
            <li>Clicking on the Description will add it to your Own Agenda</li>

            <li>
            <a target="_blank" href="planned_sessions?form.ownSessions=$sessionPlan$">Click here to open a new window with your Conference Plan and Export to PDF</a>
          </li>
          </ul>
        <b>If you want to save this page for later copy the URL</b>
        </html>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <p>Click on item to view more details of session</p>
      <div id="demo-view" class="splunk-view" data-require="app/dotconf2015/components/gantt/gantt" 
                     data-options='{ "managerid": "agenda",
                     "startField": "_time",
                     "durationField": "duration",
                     "categoryLabel": "type",
                     "categoryField": "type",
                     "seriesLabel": "track",
                     "seriesField": "track",
                     "extrasField" : "extra",
                     "tokenName": "Session_ID",
                     "tokenField": "Session_ID"}'/> 
      </html>
    </panel>
  </row>

  <row>
    <panel depends="$Session_ID$">
            <title>Click on row to add you your agenda</title>
      <table>
        <search>
          <query>|inputlookup confSessions | search Session_ID="$Session_ID$"  
          | eval sessionPlan=if(typeof("$sessionPlan$")="Number",toString("$sessionPlan$"),"$sessionPlan$")

          | eval sessionPlan=if(sessionPlan="NonePlanned",
          $Session_ID$,
          sessionPlan+","+toString(Session_ID))
          | table startTime endTime title description  location speakers sessionPlan |makemv speakers delim=";;"</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="drilldown">row</option>
        <option name="dataOverlayMode">none</option>
        <option name="linkView">search</option>
        <option name="count">10</option>
        <drilldown>
            <set token="sessionPlan">$row.sessionPlan$</set>
            <set token="form.sessionPlan">$row.sessionPlan$</set>
            <unset token="Session_ID"></unset>
        </drilldown>

      </table>
    </panel>
  </row>

  <row>
    <panel depends="$hidden$">
      <table>
        <search id="agenda">
          <query>|inputlookup confSessions | search startDate="$date$"  $skillLevel$ $track$ $products$   | append [|inputlookup confSessions |search startDate="$date$" 

            [|inputlookup confSessions | head 1 |fields |eval Session_ID="$sessionPlan$" |table Session_ID | makemv Session_ID delim="," |mvexpand Session_ID |return 10000 Session_ID] 

            | eval type="Own Plan"]  | convert timeformat="%F %H:%M" mktime(startTime) AS _time | convert timeformat="%F %H:%M" mktime(endTime)             | eval duration=endTime-_time | eval extra="{\"title\":\""+title+"\",\"Skill Level\":\""+skillLevel+"\",\"Location\":\""+location+"\"}" | table startTime duration title track type _time extra Session_ID</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
</form>